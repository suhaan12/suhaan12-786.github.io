<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Players Info & Stats</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <img class="flag-icon" src="https://flagcdn.com/32x24/${player.country.toLowerCase()}.png">
  <style>
    /* Base Styles */
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 20px;
      background-color: #f0f2f5;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark {
      background-color: #121212;
      color: #e0e0e0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    header h1 {
      margin: 0;
      flex: 1 100%;
      text-align: center;
    }
    /* Dark mode & navigation buttons */
    button, a {
      margin: 5px;
      padding: 8px 12px;
      border-radius: 4px;
      text-decoration: none;
      font-weight: bold;
      border: none;
      outline: none;
      transition: background-color 0.3s;
    }
    button {
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
    }
    button:hover {
      background-color: #45a049;
    }
    a {
      background-color: #008CBA;
      color: white;
    }
    a:hover {
      background-color: #007bb5;
    }
    /* Search Bar */
    .search-container {
      margin: 20px 0;
      text-align: center;
    }
    #search-input {
      width: 80%;
      max-width: 400px;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    /* Category and Cards */
    .player-category {
      margin-top: 30px;
    }
    .player-category h2 {
      margin-bottom: 10px;
      border-bottom: 2px solid #ddd;
      padding-bottom: 5px;
    }
    .player-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    .player-card {
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    body.dark .player-card {
      background: #1e1e1e;
    }
    .player-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 10px rgba(0,0,0,0.2);
    }
    /* Flag icon */
    .flag-icon {
      width: 32px;
      height: auto;
      border-radius: 3px;
      margin-bottom: 8px;
    }
    /* Player title badge */
    .player-title {
      font-size: 0.75em;
      font-weight: bold;
      padding: 3px 6px;
      border-radius: 4px;
      margin-top: 5px;
    }
    .title-gm {
      background-color: #ffcc00;
      color: #000;
    }
    .title-im {
      background-color: #0077b6;
      color: #fff;
    }
    .title-nm {
      background-color: #4caf50;
      color: #fff;
    }
    /* Basic stats displayed on the card */
    .card-stats {
      margin-top: 10px;
      text-align: center;
      font-size: 0.8em;
    }
    /* Modal Styles */
    .player-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      z-index: 1000;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      animation: modalIn 0.3s ease-out;
    }
    @keyframes modalIn {
      from { opacity: 0; transform: translate(-50%, -45%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    body.dark .player-modal {
      background: #2d2d2d;
      color: white;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
    .detailed-stats {
      margin-top: 20px;
      font-size: 1em;
    }
    .detailed-stats .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    body.dark .detailed-stats .stat-row {
      border-bottom: 1px solid #555;
    }
    /* Pagination controls */
    #pagination-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
    }
    #pagination-controls button {
      margin: 0 10px;
    }
    #pagination-info {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Players Info & Stats</h1>
      <div>
        <button id="toggle-dark">Toggle Dark Mode</button>
        <a href="index.html">Back to Tracker</a>
      </div>
    </header>
    
    <!-- Search bar -->
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Search player by name...">
    </div>
    
    <div id="players-section"></div>
    
    <!-- Pagination Controls -->
    <div id="pagination-controls"></div>
  </div>
  
  <script>
    
    let currentPage = 1;
    const cardsPerPage = 12;

    // Load players and populate cards
    function loadPlayers() {
      const data = JSON.parse(localStorage.getItem('eloData')) || [];
      const section = document.getElementById('players-section');
      const searchQuery = document.getElementById('search-input').value.trim().toLowerCase();

      // Filter players based on search query (if any)
      let filteredData = data.filter(player =>
        player.name.toLowerCase().includes(searchQuery)
      );

      // Sort players by rating descending
      filteredData.sort((a, b) => b.rating - a.rating);

      // Pagination
      const totalPages = Math.ceil(filteredData.length / cardsPerPage);
      if (currentPage > totalPages) currentPage = totalPages || 1;
      const start = (currentPage - 1) * cardsPerPage;
      const playersToShow = filteredData.slice(start, start + cardsPerPage);

      // Create category containers (GM, IM, NM)
      const categories = {
        GM: createCategory('Grandmasters (GM)'),
        IM: createCategory('International Masters (IM)'),
        NM: createCategory('National Masters (NM)')
      };

      // Clear any previous content from categories
      Object.values(categories).forEach(category => {
        category.querySelector('.player-cards').innerHTML = '';
      });

      // Create cards for players to show (grouped by title)
      playersToShow.forEach(player => {
        const card = createPlayerCard(player);
        card.addEventListener('click', () => showPlayerModal(player));
        if (categories[player.title]) {
          categories[player.title].querySelector('.player-cards').appendChild(card);
        }
      });

      // Clear section and append only non-empty categories
      section.innerHTML = '';
      Object.values(categories).forEach(category => {
        if (category.querySelector('.player-cards').children.length > 0) {
          section.appendChild(category);
        }
      });

      renderPagination(totalPages);
    }

    function createCategory(title) {
      const container = document.createElement('div');
      container.className = 'player-category';
      container.innerHTML = `
        <h2>${title}</h2>
        <div class="player-cards"></div>
      `;
      return container;
    }

    function createPlayerCard(player) {
      const card = document.createElement('div');
      card.className = 'player-card';

      // Calculate a simple progress percentage for rating (optional)
      const maxElo = 3000;
      const eloPercentage = (player.rating / maxElo) * 100;

      card.innerHTML = `
        <img class="flag-icon" src="https://flagcdn.com/32x24/${player.country.toLowerCase()}.png" onerror="this.style.display='none'">
        <h3 style="font-size: 1em; margin: 5px 0;">${player.name}</h3>
        <span class="player-title title-${player.title.toLowerCase()}">${player.title}</span>
        <div class="card-stats">
          <div>ELO: ${Math.round(player.rating)}</div>
          <div>Win: ${((player.wins / player.gamesPlayed) * 100 || 0).toFixed(1)}%</div>
        </div>
      `;
      
      return card;
    }

    function showPlayerModal(player) {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal()"></div>
        <div class="player-modal">
          <div style="display:flex; align-items:center; gap:10px;">
            <img class="flag-icon" src="https://flagcdn.com/32x24/${player.country.toLowerCase()}.png" alt="${player.country} flag">
            <h2 style="margin:0;">${player.name} (${player.country.toUpperCase()})</h2>
          </div>
          <div class="player-title title-${player.title.toLowerCase()}" style="margin-top:10px; display:inline-block;">
            ${player.title}
          </div>
          
          <div class="detailed-stats">
            <div class="stat-row">
              <span>Current Rating:</span>
              <span>${Math.round(player.rating)}</span>
            </div>
            <div class="stat-row">
              <span>Total Games:</span>
              <span>${player.gamesPlayed}</span>
            </div>
            <div class="stat-row">
              <span>Wins:</span>
              <span>${player.wins}</span>
            </div>
            <div class="stat-row">
              <span>Losses:</span>
              <span>${player.losses}</span>
            </div>
            <div class="stat-row">
              <span>Draws:</span>
              <span>${player.draws}</span>
            </div>
            <div class="stat-row">
              <span>Win Rate:</span>
              <span>${((player.wins / player.gamesPlayed) * 100 || 0).toFixed(1)}%</span>
            </div>
          </div>
          <button onclick="closeModal()" style="margin-top: 20px;">Close</button>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function closeModal() {
      document.querySelector('.modal-overlay')?.remove();
      document.querySelector('.player-modal')?.remove();
    }

    // Render pagination controls
    function renderPagination(totalPages) {
      const container = document.getElementById('pagination-controls');
      container.innerHTML = '';
      if (totalPages <= 1) return;

      const prevButton = document.createElement('button');
      prevButton.textContent = 'Previous';
      prevButton.disabled = currentPage === 1;
      prevButton.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          loadPlayers();
        }
      });

      const nextButton = document.createElement('button');
      nextButton.textContent = 'Next';
      nextButton.disabled = currentPage === totalPages;
      nextButton.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          loadPlayers();
        }
      });

      const pageInfo = document.createElement('span');
      pageInfo.id = 'pagination-info';
      pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

      container.appendChild(prevButton);
      container.appendChild(pageInfo);
      container.appendChild(nextButton);
    }

    // Dark mode toggle
    document.getElementById('toggle-dark').addEventListener('click', () => {
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark') ? 'enabled' : 'disabled');
    });

    // Event listener for search input
    document.getElementById('search-input').addEventListener('input', () => {
      currentPage = 1; // Reset to first page on new search
      loadPlayers();
    });

    // Set dark mode on load if enabled
    if (localStorage.getItem('darkMode') === 'enabled') {
      document.body.classList.add('dark');
    }

    // Initial load of players when page loads
    loadPlayers();
  </script>
</body>
</html>
